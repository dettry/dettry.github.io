KEEP.initUtils=()=>{KEEP.utils={rootHtmlDom:document.querySelector("html"),pageTopDom:document.querySelector(".page-main-content-top"),scrollProgressBarDom:document.querySelector(".scroll-progress-bar"),pjaxProgressBarDom:document.querySelector(".pjax-progress-bar"),pjaxProgressIcon:document.querySelector(".pjax-progress-icon"),back2TopBtn:document.querySelector(".tool-scroll-to-top"),headerWrapperDom:document.querySelector(".header-wrapper"),innerHeight:window.innerHeight,pjaxProgressBarTimer:null,prevScrollValue:0,fontSizeLevel:0,isHasScrollProgressBar:false,isHasScrollPercent:false,isHeaderTransparent:false,isHideHeader:true,hasToc:false,initData(){const e=KEEP.theme_config?.scroll||{};const t=KEEP.theme_config?.first_screen||{};this.isHasScrollProgressBar=e?.progress_bar===true;this.isHasScrollPercent=e?.percent===true;this.isHeaderTransparent=t?.enable===true&&!window.location.pathname.includes("/page/");if(!this.isHeaderTransparent){this.headerWrapperDom.classList.remove("transparent-1","transparent-2")}this.isHideHeader=e?.hide_header!==false},styleHandleWhenScroll(){const e=document.body.scrollTop||document.documentElement.scrollTop;const t=document.body.scrollHeight||document.documentElement.scrollHeight;const o=window.innerHeight||document.documentElement.clientHeight;const s=Math.round(e/(t-o)*100)||0;if(e>10){this.back2TopBtn.classList.add("show")}else{this.back2TopBtn.classList.remove("show")}if(this.isHasScrollProgressBar&&this.scrollProgressBarDom){const i=(e/(t-o)*100).toFixed(3);this.scrollProgressBarDom.style.visibility=s===0?"hidden":"visible";this.scrollProgressBarDom.style.width=`${i}%`}if(this.isHasScrollPercent&&this.back2TopBtn){this.back2TopBtn.classList.add("show-percent");const r=this.back2TopBtn.querySelector(".percent");if(s===0||s===undefined){this.back2TopBtn.classList.remove("show")}else{this.back2TopBtn.classList.add("show");r.innerHTML=s.toFixed(0);if(s>99){this.back2TopBtn.classList.add("show-arrow")}else{this.back2TopBtn.classList.remove("show-arrow")}}}if(e>this.prevScrollValue&&e>this.innerHeight){if(this.isHideHeader){this.pageTopDom.classList.add("hide")}if(this.isHeaderTransparent){this.headerWrapperDom.classList.remove("transparent-1","transparent-2")}}else{if(this.isHideHeader){this.pageTopDom.classList.remove("hide")}if(this.isHeaderTransparent){if(e<=this.headerWrapperDom.getBoundingClientRect().height){this.headerWrapperDom.classList.remove("transparent-2");this.headerWrapperDom.classList.add("transparent-1")}else if(e<this.innerHeight){this.headerWrapperDom.classList.add("transparent-2")}}}if(KEEP.theme_config?.first_screen?.enable===true){if(e>this.innerHeight-this.pageTopDom.getBoundingClientRect().height){this.pageTopDom.classList.add("reset-color")}else{this.pageTopDom.classList.remove("reset-color")}}this.prevScrollValue=e},registerWindowScroll(){window.addEventListener("scroll",()=>{this.styleHandleWhenScroll();if(KEEP.theme_config?.toc?.enable===true&&KEEP.utils?.tocHelper){KEEP.utils.tocHelper.activeNav()}KEEP.utils.headerShrink.headerShrink();KEEP.utils.headerShrink.sideToolsBarShowHandle()})},toggleShowToolsList(){const t=document.querySelector(".side-tools-list");const e=document.querySelector(".tool-toggle-show");e.addEventListener("click",e=>{t.classList.toggle("show");e.stopPropagation()});t.querySelectorAll(".tools-item").forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation()})});document.addEventListener("click",()=>{t.classList.contains("show")&&t.classList.remove("show")})},globalFontAdjust(){const e=document.defaultView.getComputedStyle(document.body).fontSize;const t=parseFloat(e);const o=()=>{const e=KEEP.getStyleStatus();if(e){this.fontSizeLevel=e.fontSizeLevel;s(this.fontSizeLevel)}};const s=e=>{this.rootHtmlDom.style.setProperty("font-size",`${t*(1+e*.05)}px`,"important");KEEP.themeInfo.styleStatus.fontSizeLevel=e;KEEP.setStyleStatus()};o();document.querySelector(".tool-font-adjust-plus").addEventListener("click",()=>{if(this.fontSizeLevel===5)return;this.fontSizeLevel++;s(this.fontSizeLevel)});document.querySelector(".tool-font-adjust-minus").addEventListener("click",()=>{if(this.fontSizeLevel<=0)return;this.fontSizeLevel--;s(this.fontSizeLevel)})},initHasToc(){const e=document.querySelectorAll(".post-toc-wrap .post-toc li");if(e.length>0){this.hasToc=true;document.body.classList.add("has-toc")}else{this.hasToc=false;document.body.classList.remove("has-toc")}},getZoomValueOfDom(e){const t=Number((e.style?.zoom||"1").replace("%",""));return t>1?t/100:t},zoomInImage(){let p=40;let g=false;let f=0;let E=null;const y=document.querySelector(".zoom-in-image-mask");const L=y?.querySelector(".zoom-in-image");const e=[...document.querySelectorAll(".keep-markdown-body img"),...document.querySelectorAll(".photo-album-box img")];const t=()=>{if(g){g=false;f=0;L&&(L.style.transform=`scale(1)`);y&&y.classList.remove("show");setTimeout(()=>{E&&E.classList.remove("hide")},300)}};const o=()=>{y&&y.addEventListener("click",()=>{t()});document.addEventListener("scroll",()=>{if(g&&Math.abs(f-window.scrollY)>=50){t()}})};const w=()=>{const e=document.body.offsetWidth;if(e<=500){p=10}else if(e<=800){p=20}else{p=40}};if(e.length){o();e.forEach(m=>{m.addEventListener("click",()=>{f=window.scrollY;g=!g;w();L.setAttribute("src",m.getAttribute("src"));E=m;if(g){const t=E.getBoundingClientRect();const o=this.getZoomValueOfDom(E);for(let e in t){t[e]=t[e]*o}const e=t.width;const s=t.height;const i=t.left;const r=t.top;const n=document.body.offsetWidth-p*2;const a=document.body.offsetHeight-p*2;const l=n/e;const c=a/s;const d=(l<c?l:c)||1;const u=n/2-(t.x+e/2)+p;const h=a/2-(t.y+s/2)+p;E.classList.add("hide");y.classList.add("show");L.style.top=r+"px";L.style.left=i+"px";L.style.width=e+"px";L.style.height=s+"px";L.style.transform=`translateX(${u}px) translateY(${h}px) scale(${d}) `}})})}},setHowLongAgoLanguage(e,t){return t.replace(/%s/g,e)},getHowLongAgo(e){const t=KEEP.language_ago;const o=Math.floor(e/(60*60*24*30)/12);const s=Math.floor(e/(60*60*24*30));const i=Math.floor(e/(60*60*24)/7);const r=Math.floor(e/(60*60*24));const n=Math.floor(e/(60*60)%24);const a=Math.floor(e/60%60);const l=Math.floor(e%60);if(o>0){return this.setHowLongAgoLanguage(o,t.year)}else if(s>0){return this.setHowLongAgoLanguage(s,t.month)}else if(i>0){return this.setHowLongAgoLanguage(i,t.week)}else if(r>0){return this.setHowLongAgoLanguage(r,t.day)}else if(n>0){return this.setHowLongAgoLanguage(n,t.hour)}else if(a>0){return this.setHowLongAgoLanguage(a,t.minute)}else if(l>0){return this.setHowLongAgoLanguage(l,t.second)}},setHowLongAgoInHome(){const{post_datetime_format:e}=KEEP.theme_config?.home||{};if(e&&e!=="ago"){return}const t=document.querySelectorAll(".post-meta-info .home-post-history");t&&t.forEach(e=>{const t=Date.now();const o=new Date(e.dataset.updated).getTime();e.innerHTML=this.getHowLongAgo(Math.floor((t-o)/1e3))})},pjaxProgressBarStart(){this.pjaxProgressBarTimer&&clearInterval(this.pjaxProgressBarTimer);if(this.isHasScrollProgressBar){this.scrollProgressBarDom.classList.add("hide")}this.pjaxProgressBarDom.style.width="0";this.pjaxProgressIcon.classList.add("show");let e=1;const t=99;this.pjaxProgressBarDom.classList.add("show");this.pjaxProgressBarDom.style.width=e+"%";this.pjaxProgressBarTimer=setInterval(()=>{e+=5;if(e>t)e=t;this.pjaxProgressBarDom.style.width=e+"%"},100)},pjaxProgressBarEnd(){this.pjaxProgressBarTimer&&clearInterval(this.pjaxProgressBarTimer);this.pjaxProgressBarDom.style.width="100%";const t=setTimeout(()=>{this.pjaxProgressBarDom.classList.remove("show");this.pjaxProgressIcon.classList.remove("show");if(this.isHasScrollProgressBar){this.scrollProgressBarDom.classList.remove("hide")}const e=setTimeout(()=>{this.pjaxProgressBarDom.style.width="0";clearTimeout(t),clearTimeout(e)},200)},200)},insertTooltipContent(){const{root:E}=KEEP.theme_config;const y=KEEP.theme_config?.lazyload?.enable===true;const e=()=>{document.querySelectorAll(".tooltip").forEach(e=>{const{tooltipContent:t,tooltipOffsetX:o,tooltipOffsetY:s}=e.dataset;let i="";if(o){i+=`left: ${o};`}if(s){i+=`top: ${s};`}if(i){i=`style="${i}"`}if(t){e.insertAdjacentHTML("afterbegin",`<span class="tooltip-content" ${i}>${t}</span>`)}});const p={};const g=(e,t,o="click")=>{if(o==="hover"){o="mouseout"}document.addEventListener(o,()=>{if(p[t].isShowImg){e.classList.remove("show-img");p[t].isShowImg=false}})};const f=(e,t)=>{const o=new Image;const{src:s}=e.dataset;o.src=s;o.onload=()=>{e.src=s;e.removeAttribute("lazyload");t=true}};document.querySelectorAll(".tooltip-img").forEach((t,o)=>{const{tooltipImgName:s,tooltipImgUrl:i,tooltipImgTip:e,tooltipImgTrigger:r="click",tooltipImgStyle:n}=t.dataset;let a="";if(n){a=`style="${n}"`}let l="";if(e){l=`<div class="tip">${e}</div>`}if(i){const c=`tooltip-img-${o}-${s?s:Date.now()}`;const d=`${s}-${o}`;const u=(/^(https?:\/\/)/.test(i)?"":E)+i;const h=`<img class="${c}"
                              ${y?"lazyload":""}
                              ${y?"data-":""}src="${u}"
                              alt="${c}"
                            >`;const m=`<div ${a} class="tooltip-img-box ${l?"has-tip":""}">${h}${l}</div>`;p[d]={imgLoaded:false,isShowImg:false};t.insertAdjacentHTML("afterbegin",m);let e="click";if(r==="hover"){e="mouseover"}t.addEventListener(e,e=>{if(y&&!p[d].imgLoaded){f(document.querySelector(`.tooltip-img-box img.${c}`),p[d].imgLoaded)}p[d].isShowImg=!p[d].isShowImg;t.classList.toggle("show-img");e.stopPropagation()});g(t,d,r)}})};setTimeout(()=>{e()},1e3)},siteCountInitialize(){if(KEEP.theme_config?.website_count?.busuanzi_count?.enable===true){const t="busuanzi-js";let e=document.body.querySelector(`#${t}`);if(!e){e=document.createElement("script");e.setAttribute("data-pjax","");e.setAttribute("id",t);e.async=true;e.src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js";document.body.appendChild(e)}const s=e=>{return document.querySelector(e)?.innerText};e.onload=()=>{setTimeout(()=>{if(s("#busuanzi_value_site_uv")||s("#busuanzi_value_site_pv")||s("#busuanzi_value_page_pv")){const e=document.querySelector(".footer .count-item .uv");const t=document.querySelector(".footer .count-item .pv");const o=document.querySelector(".post-meta-info .post-pv");e&&(e.style.display="flex");t&&(t.style.display="flex");o&&(o.style.display="inline-block")}},1e3)}}},pageNumberJump(){const r=document.querySelector(".paginator .page-number-input");r&&r.addEventListener("change",e=>{const t=1;const o=Number(e.target.max);let s=Number(e.target.value);if(s<=0){r.value=t;s=t}if(s>o){r.value=o;s=o}const i=window.location.href.replace(/\/$/,"").split("/page/")[0];if(s===1){window.location.href=i}else{window.location.href=i+"/page/"+s}})},tabsActiveHandle(){const s=(e,t,o)=>{e.forEach(e=>{if(o.dataset.href===e.dataset.href){e.classList.add("active")}else{e.classList.remove("active")}});t.forEach(e=>{if(o.dataset.href===e.id){e.classList.add("active")}else{e.classList.remove("active")}})};const e=document.querySelectorAll(".keep-tabs");e.length&&e.forEach(e=>{const t=e.querySelectorAll(".tabs-nav .tab");const o=e.querySelectorAll(".tabs-content .tab-pane");t.forEach(e=>{e.addEventListener("click",()=>{s(t,o,e)})})})},initTypewriter(){const e=KEEP.theme_config?.first_screen||{};const t=e?.hitokoto===true;if(e?.enable!==true){return}if(e?.enable===true&&!t&&!e?.description){return}const o=document.querySelector(".first-screen-content .description");if(o){o.style.opacity="0";setTimeout(()=>{o.style.opacity="1";const e=o.querySelectorAll(".desc-item");e.forEach(e=>{const t=e.querySelector(".desc");const o=e.querySelector(".cursor");const s=t.innerHTML;t.innerHTML="";let i=0;if(s){const r=()=>{if(i<s.length){t.textContent+=s.charAt(i);i++;setTimeout(r,100)}else{o.style.display="none"}};r()}})},t?400:300)}},removeWhitespace(e){if(!e){return}const t=e.childNodes;const o=[];for(let e=0;e<t.length;e++){const s=t[e];if(s.nodeType===3&&/^\s*$/.test(s.nodeValue)){o.push(s)}}for(const i of o){e.removeChild(i)}},trimPostMetaInfoBar(){this.removeWhitespace(document.querySelector(".post-meta-info-container .post-category-ul"));this.removeWhitespace(document.querySelector(".post-meta-info-container .post-tag-ul"))},closeWebsiteAnnouncement(){if(KEEP.theme_config?.home?.announcement){const e=document.querySelector(".home-content-container .website-announcement");if(e){const t=e.querySelector(".close");t.addEventListener("click",()=>{e.style.display="none"})}}},wrapTableWithBox(){document.querySelectorAll("table").forEach(e=>{const t=document.createElement("div");t.className="table-container";e.wrap(t)})},title2Top4HTag(s,i,r,n){if(s&&i){s.addEventListener("click",e=>{e.preventDefault();n&&n();let t=window.scrollY;t=t<=1?-19:t;let o=i.getBoundingClientRect().top+t;if(!this.isHideHeader){o=o-this.headerWrapperDom.getBoundingClientRect().height}window.anime({targets:document.scrollingElement,duration:r,easing:"linear",scrollTop:o,complete:()=>{history.pushState(null,document.title,s.href);if(this.isHideHeader){setTimeout(()=>{this.pageTopDom.classList.add("hide")},160)}}})})}},aAnchorJump(){document.querySelectorAll("a.headerlink").forEach(e=>{this.title2Top4HTag(e,e.parentNode,10)})}};KEEP.utils.initData();KEEP.utils.registerWindowScroll();KEEP.utils.toggleShowToolsList();KEEP.utils.globalFontAdjust();KEEP.utils.initHasToc();KEEP.utils.zoomInImage();KEEP.utils.setHowLongAgoInHome();KEEP.utils.insertTooltipContent();KEEP.utils.siteCountInitialize();KEEP.utils.pageNumberJump();KEEP.utils.tabsActiveHandle();KEEP.utils.initTypewriter();KEEP.utils.trimPostMetaInfoBar();KEEP.utils.closeWebsiteAnnouncement();KEEP.utils.wrapTableWithBox();KEEP.utils.aAnchorJump()};