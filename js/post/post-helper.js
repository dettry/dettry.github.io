function initPostHelper(){KEEP.utils.postHelper={postPageContainerDom:document.querySelector(".post-page-container"),toggleShowTocBtn:document.querySelector(".toggle-show-toc"),toggleShowTocTabletBtn:document.querySelector(".toggle-show-toc-tablet"),toggleShowTocIcon:document.querySelector(".toggle-show-toc i"),mainContentDom:document.querySelector(".main-content"),postToolsDom:document.querySelector(".post-tools"),isShowToc:false,initToggleToc(){this.toggleShowTocBtn&&this.toggleShowTocBtn.addEventListener("click",()=>{this.isShowToc=!this.isShowToc;KEEP.themeInfo.styleStatus.isShowToc=this.isShowToc;KEEP.setStyleStatus();this.handleToggleToc(this.isShowToc)});this.toggleShowTocTabletBtn&&this.toggleShowTocTabletBtn.addEventListener("click",()=>{const e=document.querySelector(".tablet-post-toc-mask");const t=e.querySelector(".tablet-post-toc");document.body.style.overflow=`hidden`;e.style.background=`rgba(0, 0, 0, 0.25)`;e.style.visibility=`visible`;t.style.transform=`translateX(0)`;e.addEventListener("click",()=>{document.body.style.overflow="";e.style.background=`rgba(0, 0, 0, 0)`;e.style.visibility=`hidden`;t.style.transform=`translateX(-100%)`})})},handleToggleToc(e){if(e){this.postPageContainerDom.classList.add("show-toc");document.body.classList.add("has-toc")}else{this.postPageContainerDom.classList.remove("show-toc");document.body.classList.remove("has-toc")}setTimeout(()=>{this.setPostToolsLayout()},120)},hasToc(e){if(this.toggleShowTocBtn){this.toggleShowTocBtn.style.display="flex";this.isShowToc=e;this.handleToggleToc(e)}},setPostToolsLayout(e){const t=e?e:this.mainContentDom.getBoundingClientRect().width.toFixed(0);let o=5;if(window.innerWidth<=800){o=3}const s=KEEP.theme_config.toc?.layout==="left"?"right":"left";this.postToolsDom.style.opacity=`1`;this.postToolsDom.style[s]=`calc((100vw - ${t}px) / 2 - ${o}rem)`},initSetPostToolsLeft(){setTimeout(()=>{this.setPostToolsLayout()},150);window.addEventListener("resize",()=>{this.setPostToolsLayout()})},goToComments(){const t=document.querySelector("#comments-anchor");const e=[document.querySelector(".post-tools .go-to-comments"),document.querySelector(".exposed-tools-list .go-to-comments-tablet")];e.forEach(e=>{KEEP.utils.title2Top4HTag(e,t,300)})},watchPostCommentsCount(){const o=this.postToolsDom.querySelector(".post-comments-count");if(!o)return;const e={attributes:true,childList:true};const t=function(e){e.forEach(e=>{if(e.type==="childList"){const t=Number(e.target.innerHTML);if(t>0){o.style.display="flex";if(t>99){o.innerHTML="99+";s.disconnect()}}}})};const s=new MutationObserver(t);s.observe(o,e)},setArticleAgingDays(){const e=document.querySelector(".post-content .post-aging-tips");if(e){const t=e.querySelector(".days");const o=Date.now();const s=24*60*60*1e3;const n=(e.dataset?.agingDays||30)*s;const c=new Date(e.dataset.updateDate).getTime();const l=o-c;const i=(l/s).toFixed(0);if(l>=n){t.innerHTML=i;e.style.display="block"}}},formatDatetime(e="YYYY-MM-DD hh:mm:ss",t=Date.now()){function o(e){return`00${e}`.substr(e.length)}const s=new Date(t);if(/(y+)/.test(e)||/(Y+)/.test(e)){e=e.replace(RegExp.$1,`${s.getFullYear()}`.substr(4-RegExp.$1.length))}const n={"M+":s.getMonth()+1,"D+":s.getDate(),"d+":s.getDate(),"H+":s.getHours(),"h+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds()};for(const c in n){if(new RegExp(`(${c})`).test(e)){const l=`${n[c]}`;e=e.replace(RegExp.$1,RegExp.$1.length===1?l:o(l))}}return e},resetPostUpdateDate(){const e=document.querySelector(".post-meta-info-container .post-update-date .datetime");const t=new Date(e.dataset.updated).getTime();const o=KEEP.theme_config.post?.datetime_format||"YYYY-MM-DD HH:mm:ss";e.innerHTML=this.formatDatetime(o,t)},enableFullScreen(){const e=document.querySelector(".post-tools-container .full-screen");if(e){const t=e.querySelector("i");const o=()=>{return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement};const s=()=>{if(!o()){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else if(document.documentElement.webkitRequestFullScreen){document.documentElement.webkitRequestFullScreen()}}else{if(document.exitFullscreen){document.exitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}};const n=()=>{if(o()){t.classList.remove("fa-expand");t.classList.add("fa-compress")}else{t.classList.remove("fa-compress");t.classList.add("fa-expand")}};e.addEventListener("click",function(){s()});document.addEventListener("fullscreenchange",n);document.addEventListener("mozfullscreenchange",n);document.addEventListener("webkitfullscreenchange",n)}}};KEEP.utils.postHelper.initSetPostToolsLeft();KEEP.utils.postHelper.setArticleAgingDays();KEEP.utils.postHelper.resetPostUpdateDate();KEEP.utils.postHelper.enableFullScreen();if(KEEP.theme_config.toc?.enable===true){KEEP.utils.postHelper.initToggleToc()}if(KEEP.theme_config.comment?.enable===true){KEEP.utils.postHelper.goToComments();KEEP.utils.postHelper.watchPostCommentsCount()}}if(KEEP.theme_config.pjax?.enable===true&&KEEP.utils){initPostHelper()}else{window.addEventListener("DOMContentLoaded",initPostHelper)}